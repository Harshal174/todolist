<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ToDoList</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
     <!-- Navbar with hamburger button -->
     <div class="navbar">
        <span class="hamburger" onclick="toggleSidebar()">&#9776;</span>
        <h1><%=listTitle%></h1>
        <div class="profile-image-container">
          <img src="image.png" alt="User Profile" class="profile-image" id="profileImage">
        </div>
        
    </div>
    <!-- Sidebar -->
    <div id="sidebar" class="sidebar">
        <a href="javascript:void(0)" class="close-btn" onclick="toggleSidebar()">&times;</a>
        <button class="sidebar-btn create-btn" onclick="openModal()">
            &#43; Create</button>
        <button class="sidebar-btn">All Tasks</button>
        <button class="sidebar-btn">Starred</button>
        <button class="sidebar-btn">Today's Tasks</button>
        <button class="sidebar-btn">Logout</button>
    </div>
    <!-- Modal for Creating Task -->
    <div id="taskModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal()">&times;</span>
            <h2>Add New Task</h2>
            <form action="/addTask" method="post">
                <label for="taskTitle">Add Title</label>
                <input type="text" id="taskTitle" name="taskTitle" placeholder="Task Title" required>
                
                <label for="taskDate">Choose Date</label>
                <input type="date" id="taskDate" name="taskDate" required>

                <label for="taskPriority">Priority</label>
                <select id="taskPriority" name="taskPriority" required>
                    <option value="high">High</option>
                    <option value="intermediate">Intermediate</option>
                    <option value="low">Low</option>
                </select>

                <button type="submit">Done</button>
            </form>
        </div>
        </div>
    <div class="box">
      <h1 id="heading"><%= listTitle %></h1>
        <% newListItems.forEach(function(item){ %>
            <div class="item">
              
              <!-- Task name -->
              <p><%= item.name %></p>
              
              <!-- Three-dotted button for dropdown options (Edit, Complete, Delete) -->
              <div class="dropdown">
                <button class="dropdown-btn">⋮</button> <!-- Three dots button -->
                <div class="dropdown-content">
                  <!-- Edit option (Implement link/action for editing here) -->
                  <a href="#">Edit</a>
                  <!-- Completed option -->
                  <a href="#" onclick="markCompleted('<%= item._id %>')">Completed</a>
                  <!-- Delete option -->
                  <a href="#" onclick="deleteItem('<%= item._id %>')">Delete</a>
                </div>
              </div>
            </div>
          <% }) %>
        
          <!-- Add a new task field with a three-dotted option on the right -->
          <div class="add-task">
            <form class="" action="/" method="post" style="display: inline-block;">
              <input type="text" name="newItem" placeholder="Add a new task" autocomplete="off">
              <button type="submit" name="list" value="<%= listTitle %>">+</button>
            </form>
        
            <!-- Three-dotted button for dropdown (New task options, could be extra features like priorities, tags, etc.) -->
            <div class="dropdown" style="display: inline-block;">
              <button class="dropdown-btn">⋮</button>
              <div class="dropdown-content">
                <!-- Options for new task (These could be extended to handle priorities, etc.) -->
                <a href="#">Set Priority</a>
                <a href="#">Add Tag</a>
              </div>
            </div>
          </div>
          
          <!-- Completed tasks link -->
          <a class="completed-tag" style="text-decoration: none;" href="/complete/<%= listTitle %>">Completed Tasks</a>
        
    </div>
    <script>
        function toggleSidebar() {
            var sidebar = document.getElementById("sidebar");
            if (sidebar.style.width === "250px") {
                sidebar.style.width = "0";
            } else {
                sidebar.style.width = "250px";
            }
        }
        // Open Modal to Add Task
        function openModal() {
            document.getElementById("taskModal").style.display = "block";
        }

        // Close Modal
        function closeModal() {
            document.getElementById("taskModal").style.display = "none";
        }

        // Close the modal when clicking outside the modal content
        window.onclick = function(event) {
            var modal = document.getElementById("taskModal");
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }
        // Function to mark an item as completed
  function markCompleted(itemId) {
    var form = document.createElement('form');
    form.method = 'post';
    form.action = '/completed'; // Route to mark as completed

    var input = document.createElement('input');
    input.type = 'hidden';
    input.name = 'completedCheckbox';
    input.value = itemId;
    form.appendChild(input);

    document.body.appendChild(form);
    form.submit(); // Submit form to complete task
  }

  // Function to delete a task
  function deleteItem(itemId) {
    var form = document.createElement('form');
    form.method = 'post';
    form.action = '/delete'; // Route to delete task

    var input = document.createElement('input');
    input.type = 'hidden';
    input.name = 'checkbox';
    input.value = itemId;
    form.appendChild(input);

    document.body.appendChild(form);
    form.submit(); // Submit form to delete task
  }
    </script>
</body>
</html>