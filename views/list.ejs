<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ToDoList</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
     <!-- Navbar with hamburger button -->
     <div class="navbar">
        <span class="hamburger" onclick="toggleSidebar()">&#9776;</span>
        <h1><%=listTitle%></h1>
        
        <div class="profile-image-container">
          <i class="fas fa-user-circle"></i>
          <!-- <img src="image.jpg" alt="User Profile" class="profile-image" id="profileImage"> -->
        </div>  
        <button class="help-btn" style="right: 80px; padding: 0;" onclick="openHelpModal()"><i class="fas fa-question-circle"></i></button>
      
    </div>
     <!-- Help Modal -->
<div id="helpModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeHelpModal()">&times;</span>
    <!-- <h2>Help Information</h2>
    <p id="help-info">Here you can add information later, such as guidelines or tips for the user.</p> -->
    <div id="popup" class="hidden absolute z-10 w-64 p-4 bg-card text-card-foreground border border-border rounded-lg shadow-lg">
      <h3 class="font-bold mb-2">Keyboard Shortcuts</h3>
      <div class="mb-4">
        <h4 class="font-semibold">Navigation</h4>
        <ul class="list-disc list-inside">
          <li>Focus previous: Up</li>
          <li>Focus next: Down</li>
          <li>Focus first: Home</li>
          <li>Focus last: End</li>
        </ul>
      </div>
      <div>
        <h4 class="font-semibold">Task actions</h4>
        <ul class="list-disc list-inside">
          <li>Create: C</li>
          <li>Mark complete/incomplete: Space</li>
          <li>Edit: Return, Enter</li>
          <li>Delete: Backspace, Delete</li>
          <li>Move task up/down: Ctrl+Up/Down</li>
          <li>Move task to top/bottom: Ctrl+Shift+Up/Down</li>
          <li>Indent: Ctrl + ]</li>
          <li>Unindent: Ctrl + [</li>
        </ul>
      </div>
    </div>
  </div>
</div>
    <!-- Sidebar -->
    <div id="sidebar" class="sidebar">
        <a href="javascript:void(0)" class="close-btn" onclick="toggleSidebar()">&times;</a>
        <button class="sidebar-btn create-btn" onclick="openModal()">
            &#43; Create</button>
        <button class="sidebar-btn"><i class="fas fa-check-circle"></i>
          All Tasks</button>
        <button class="sidebar-btn"><i class="fas fa-star"></i>
          Starred</button>
        <button class="sidebar-btn"><i class="fas fa-calendar"></i> Today's Tasks</button>
        <button id="logout-btn" class="sidebar-btn" onclick="logOut()" ><span class="material-icons" >exit_to_app</span> Logout</button>
    </div>
    <!-- Modal for Creating Task -->
    <div id="taskModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal()">&times;</span>
            <h2>Add New Task</h2>
            <form action="/addTask" method="post">
                <label for="taskTitle">Add Title</label>
                <input type="text" id="taskTitle" name="taskTitle" placeholder="Task Title" required>
                
                <label for="taskDate">Choose Date</label>
                <input type="date" id="taskDate" name="taskDate" required>

                <label for="taskPriority">Priority</label>
                <select id="taskPriority" name="taskPriority" required>
                    <option value="high">High</option>
                    <option value="intermediate">Intermediate</option>
                    <option value="low">Low</option>
                </select>

                <button type="submit">Done</button>
            </form>
        </div>
        </div>
    <div class="box">
      <h1 id="heading"><%= listTitle %></h1>
        <% newListItems.forEach(function(item){ %>
            <div class="item">
              
              <!-- Task name -->
              <p><%= item.name %></p>
              
              <!-- Three-dotted button for dropdown options (Edit, Complete, Delete) -->
              <div class="dropdown">
                <button class="dropdown-btn">⋮</button> <!-- Three dots button -->
                <div class="dropdown-content">
                  <!-- Edit option (Implement link/action for editing here) -->
                  <a href="#">Edit</a>
                  <!-- Completed option -->
                  <a href="#" onclick="markCompleted('<%= item._id %>','<%= listTitle %>')">Completed</a>
                  <!-- Delete option -->
                  <a href="#" onclick="deleteItem('<%= item._id %>','<%= listTitle %>')">Delete</a>
                </div>
              </div>
            </div>
          <% }) %>
        
          <!-- Add a new task field with a three-dotted option on the right -->
          <div class="add-task">
            <form class="" action="/" method="post" style="display: inline-block;">
              <input type="text" name="newItem" placeholder="Add a new task" autocomplete="off">
              <button type="submit" name="list" value="<%= listTitle %>">+</button>
            </form>
        
            <!-- Three-dotted button for dropdown (New task options, could be extra features like priorities, tags, etc.) -->
            <div class="dropdown" style="display: inline-block;">
              <button class="dropdown-btn">⋮</button>
              <div class="dropdown-content">
                <!-- Options for new task (These could be extended to handle priorities, etc.) -->
                <a href="#">Set Priority</a>
                <a href="#">Add Tag</a>
              </div>
            </div>
          </div>
          
          <!-- Completed tasks link -->
          <a class="completed-tag" style="text-decoration: none;" href="/complete/<%= listTitle %>">Completed Tasks</a>
        
    </div>
    <script>
        function toggleSidebar() {
            var sidebar = document.getElementById("sidebar");
            if (sidebar.style.width === "250px") {
                sidebar.style.width = "0";
            } else {
                sidebar.style.width = "250px";
            }
        }
        // Open Modal to Add Task
        function openModal() {
            document.getElementById("taskModal").style.display = "block";
        }

        // Close Modal
        function closeModal() {
            document.getElementById("taskModal").style.display = "none";
        }

        // Close the modal when clicking outside the modal content
        window.onclick = function(event) {
            var modal = document.getElementById("taskModal");
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }
        // Function to mark an item as completed
  function markCompleted(itemId,listTitle) {
    var form = document.createElement('form');
    form.method = 'post';
    form.action = '/delete'; // Route to mark as completed

    var inputId = document.createElement('input');
    inputId.type = 'hidden';
    inputId.name = 'completedCheckbox';
    inputId.value = itemId;
    form.appendChild(inputId);

    var inputName = document.createElement('input');
    inputName.type = 'hidden';
    inputName.name = 'listTitle';
    inputName.value = listTitle;
    form.appendChild(inputName);

    document.body.appendChild(form);
    form.submit(); // Submit form to complete task
  }

  // Function to delete a task
  function deleteItem(itemId,listTitle) {
    var form = document.createElement('form');
    form.method = 'post';
    form.action = '/delete'; // Route to delete task

    var inputId = document.createElement('input');
    inputId.type = 'hidden';
    inputId.name = 'checkbox';
    inputId.value = itemId;
    form.appendChild(inputId);

    var inputName = document.createElement('input');
    inputName.type = 'hidden';
    inputName.name = 'listTitle';
    inputName.value = listTitle;
    form.appendChild(inputName);


    document.body.appendChild(form);
    form.submit(); // Submit form to delete task
  }
  // Open the modal
function openHelpModal() {
  document.getElementById("helpModal").style.display = "block";
}

// Close the modal
function closeHelpModal() {
  document.getElementById("helpModal").style.display = "none";
}

function logOut(){
    var form=document.createElement('form');
    form.method='post';
    form.action='/logout';
    document.body.appendChild(form);
    form.submit();
}

// Close the modal if user clicks outside the modal content
window.onclick = function(event) {
  var modal = document.getElementById("helpModal");
  if (event.target == modal) {
    modal.style.display = "none";
  }
}
    </script>
</body>
</html>